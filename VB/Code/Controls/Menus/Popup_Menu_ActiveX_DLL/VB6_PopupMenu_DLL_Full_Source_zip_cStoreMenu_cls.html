<html lang="en" >

<!-- Mirrored from www.vbaccelerator.com/home/VB/Code/Controls/Menus/Popup_Menu_ActiveX_DLL/VB6_PopupMenu_DLL_Full_Source_zip_cStoreMenu_cls.asp by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Jun 2015 21:30:12 GMT -->
<head>
<title>vbAccelerator - Contents of code file: cStoreMenu.cls</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: cStoreMenu.cls" /><link rel="stylesheet" href="../../../../../res/screen.css" media="SCREEN" /><link rel="stylesheet" href="../../../../../res/print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000.html";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="../../../../../../../pagead2.googlesyndication.com/pagead/f.txt">
</script>
</p>
</td>
<td></td>
</tr></tr><tr class="navbar"><td><a href="http://www.vbaccelerator.com/home/index.asp"><img width="125" height="25" src="../../../../../res/vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="http://www.vbaccelerator.com/home/index.asp">Home</a>&#160;.&#160;<a href="../../../../index.html">VB</a>&#160;.&#160;<a href="../../../index.html">Code</a>&#160;.&#160;<a href="../../index.html">Controls</a>&#160;.&#160;<a href="../index.html">Menus</a>&#160;.&#160;<a href="article.html">PopupMenu DLL - Create Unlimited Popup Menus</a>&#160;.&#160;<a href="VB6_PopupMenu_DLL_Full_Source.html">VB6 PopupMenu DLL Full Source</a>&#160;.&#160;cStoreMenu.cls</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="../../../../../res/download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="PopMenu_DLL_Documentation.html"><img src="../../../../../res/get.png" width="8" height="8" alt="Download Page" />PopMenu DLL Documentation</a> (3K)</p><p /><p class="nav"><a href="VB5_PopupMenu_DLL_Binary.html"><img src="../../../../../res/get.png" width="8" height="8" alt="Download Page" />VB5 PopupMenu DLL Binary</a> (51K)</p><p class="nav"><a href="VB5_PopupMenu_DLL_Demonstration.html"><img src="../../../../../res/get.png" width="8" height="8" alt="Download Page" />VB5 PopupMenu DLL Demonstration</a> (78K)</p><p class="nav"><a href="VB5_PopupMenu_DLL_Full_Source.html"><img src="../../../../../res/get.png" width="8" height="8" alt="Download Page" />VB5 PopupMenu DLL Full Source</a> (184K)</p><p /><p class="nav"><a href="VB6_PopupMenu_DLL_Binary.html"><img src="../../../../../res/get.png" width="8" height="8" alt="Download Page" />VB6 PopupMenu DLL Binary</a> (52K)</p><p class="nav"><a href="VB6_PopupMenu_DLL_Demonstration.html"><img src="../../../../../res/get.png" width="8" height="8" alt="Download Page" />VB6 PopupMenu DLL Demonstration</a> (76K)</p><p class="nav"><a href="VB6_PopupMenu_DLL_Full_Source.html"><img src="../../../../../res/get.png" width="8" height="8" alt="Download Page" />VB6 PopupMenu DLL Full Source</a> (185K)</p><br /><br /><img src="../../../../../res/information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:311</p><p class="nav">&#160;&#160;<a href="http://www.vbaccelerator.com/linkto.asp?id=311&amp;type=Zip&amp;title=VB6%20PopupMenu%20DLL%20Full%20Source%2Ezip%5FcStoreMenu">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="../../../../../res/bugTrak.png" width="125" height="21" alt="BugTrak System" />﻿<p class="nav"><a href="bugTrak.html">BugTrak</a></p><p class="nav"><a href="bugTrak.html#bugs"><img src="../../../../../res/btBug.png" width="16" height="16" alt="Bug" />&#160;Bugs:</a> 12 / 13</p><p class="nav"><a href="bugTrak.html#issues"><img src="../../../../../res/btIssue.png" width="16" height="16" alt="Issue" />&#160;Issues:</a> 0 / 0</p><p class="nav"><a href="bugTrak.html#questions"><img src="../../../../../res/btQuestion.png" width="16" height="16" alt="Question" />&#160;Questions:</a> 0 / 0</a></p><p class="nav">Updated:6 February 2004</p>
<br /><br /><img src="../../../../../res/updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="../../../../../res/update.png" width="8" height="8" alt="Update" />23 Apr 2003<br /><p class="update">If an menu was used as a drop-down from
a vbAccelerator Toolbar control, and it contained infrequently used items
which were hidden, once the items were exposed they did not respond when
clicked. Now all items click correctly.</p><p class="update">When showing as a chevron in a menu, if you customised
which buttons were visible they could incorrectly appear in the chevron
menu.</p><p class="update">Disabled items now draw in the correct colour when XP
style is in effect.</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="../../../../../res/related.png" width="125" height="21" alt="Related Items" />﻿<p class="nav"><img src="../../../../../res/rel.png" width="8" height="8" alt="Related Item" /><a href="http://www.vbaccelerator.com/article.asp?id=17">Subclassing Without The Crashes</a></p><br /><br /><img src="../../../../../res/search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="http://www.google.com/search"><img src="../../../../../../../www.google.com/logos/Logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="http://www.vbaccelerator.com/home/The_Site/NewSite/article.asp"><img src="../../../../../res/newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: cStoreMenu.cls</h1><pre>VERSION 1.0 CLASS
BEGIN
  MultiUse = -1  'True
  Persistable = 0  'NotPersistable
  DataBindingBehavior = 0  'vbNone
  DataSourceBehavior  = 0  'vbNone
  MTSTransactionMode  = 0  'NotAnMTSObject
END
Attribute VB_Name = "pcStoreMenu"
Attribute VB_GlobalNameSpace = True
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Option Explicit

Private m_tMI() As tMenuItem
Private m_iMenuCount As Long
Private m_sKey As String
Private m_sFailure As String

Friend Property Get Error() As String
   Error = m_sFailure
End Property

Friend Function Serialise(ByVal iFile As Integer) As Boolean
Dim sHeader As String
Dim tMI As tMenuItem
Dim iItem As Long

On Error GoTo ErrorHandler
   Put #iFile, , "cStoreMenu"
   sHeader = App.Major &amp; ":" &amp; App.Minor &amp; "," &amp; LenB(tMI)
   Put #iFile, , Len(sHeader)
   Put #iFile, , sHeader
   Put #iFile, , Len(m_sKey)
   If Len(m_sKey) &gt; 0 Then
      Put #iFile, , m_sKey
   End If
   Put #iFile, , m_iMenuCount
   For iItem = 1 To m_iMenuCount
      Put #iFile, , m_tMI(iItem)
   Next iItem
   Serialise = True
   Exit Function

ErrorHandler:
   m_sFailure = Err.Description
   Serialise = False
   Exit Function
End Function
Friend Function Deserialise(ByVal iFile As Integer) As Boolean
Dim sInfo As String
Dim iLen As Long
Dim iCount As Long
Dim iItem As Long

On Error GoTo ErrorHandler
   sInfo = Space$(10)
   Get #iFile, , sInfo
   If sInfo = "cStoreMenu" Then
      Get #iFile, , iLen
      sInfo = Space$(iLen)
      Get #iFile, , sInfo
      ' This returns the app version &amp; length of the tMI structure.  In future
      ' versions this will inform us how to read old data streams, for now
      ' we can just read it as this is the first version which supports
       serialisation
      Get #iFile, , iLen
      If iLen &gt; 0 Then
         sInfo = Space$(iLen)
         Get #iFile, , sInfo
      End If
      Get #iFile, , iCount
      ' Check not stupid...
      If iCount &gt; -1 And iCount &lt; 32767 Then
         m_iMenuCount = iCount
         If iCount = 0 Then
            Erase m_tMI
         Else
            ReDim m_tMI(1 To m_iMenuCount) As tMenuItem
            For iItem = 1 To m_iMenuCount
               Get #iFile, , m_tMI(iItem)
            Next iItem
            Deserialise = True
         End If
         m_sKey = sInfo
      Else
         m_sFailure = "Invalid number of Menu items"
      End If
   Else
      m_sFailure = "Not a cNewMenu data stream"
   End If
   Exit Function

ErrorHandler:
   m_sFailure = Err.Description
   Deserialise = False
   Exit Function
End Function

Friend Property Get Key() As String
   Key = m_sKey
End Property
Friend Property Let Key(ByVal sKey As String)
   m_sKey = sKey
End Property

Friend Sub Store(ByRef tMI() As tMenuItem, ByVal iMenuCount As Long)
Dim iItem As Long
Dim iRealCount As Long
Dim lSeek As Long
Dim lOrigParent As Long
Dim lIdx() As Long
   
   m_iMenuCount = iMenuCount
   If m_iMenuCount &gt; 0 Then
      ReDim Preserve m_tMI(1 To m_iMenuCount) As tMenuItem
      For iItem = 1 To m_iMenuCount
         LSet m_tMI(iItem) = tMI(iItem)
      Next iItem
   Else
      m_iMenuCount = 0
      Erase m_tMI
   End If
   
End Sub
Friend Sub Restore(ByRef cMenu As cPopupMenu)
Dim iItem As Long
Dim iSubItem As Long
Dim iAdded As Long
   With cMenu
      For iItem = 1 To m_iMenuCount
         iAdded = .AddItem(m_tMI(iItem).sInputCaption, m_tMI(iItem).sHelptext,
          m_tMI(iItem).lItemData, m_tMI(iItem).lParentIndex,
          m_tMI(iItem).lIconIndex, m_tMI(iItem).bChecked,
          m_tMI(iItem).bEnabled, m_tMI(iItem).sKey)
         .Header(iAdded) = m_tMI(iItem).bTitle
         .Default(iAdded) = m_tMI(iItem).bDefault
         .OwnerDraw(iAdded) = m_tMI(iItem).bOwnerDraw
         .RadioCheck(iAdded) = m_tMI(iItem).bRadioCheck
         .Visible(iAdded) = m_tMI(iItem).bVisible
         .ItemInfrequentlyUsed(iAdded) = m_tMI(iItem).bInfrequent
         .ShowCheckAndIcon(iAdded) = m_tMI(iItem).bShowCheckAndIcon
         .RedisplayMenuOnClick(iAdded) = m_tMI(iItem).bChevronBehaviour
      Next iItem
   End With
End Sub

</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center"></p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="http://www.vbaccelerator.com/home/index.asp"><img width="125" height="25" src="../../../../../res/vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="http://www.vbaccelerator.com/home/index.asp">Home</a>&#160;.&#160;<a href="../../../../index.html">VB</a>&#160;.&#160;<a href="../../../index.html">Code</a>&#160;.&#160;<a href="../../index.html">Controls</a>&#160;.&#160;<a href="../index.html">Menus</a>&#160;.&#160;<a href="article.html">PopupMenu DLL - Create Unlimited Popup Menus</a>&#160;.&#160;<a href="VB6_PopupMenu_DLL_Full_Source.html">VB6 PopupMenu DLL Full Source</a>&#160;.&#160;cStoreMenu.cls</p><br /><p class="nav"><a href="http://www.vbaccelerator.com/home/The_Site/Copyright/article.asp">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 24 April 2003</p></td><td></td></tr></table>
</body>
<!-- Mirrored from www.vbaccelerator.com/home/VB/Code/Controls/Menus/Popup_Menu_ActiveX_DLL/VB6_PopupMenu_DLL_Full_Source_zip_cStoreMenu_cls.asp by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Jun 2015 21:30:12 GMT -->
</html>