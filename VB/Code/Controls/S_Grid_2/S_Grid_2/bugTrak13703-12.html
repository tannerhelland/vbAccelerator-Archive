<html lang="en" >

<!-- Mirrored from www.vbaccelerator.com/home/VB/Code/Controls/S_Grid_2/S_Grid_2/bugTrak13703-12.asp by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Jun 2015 21:30:06 GMT -->
<head>
<title>vbAccelerator - Various Bug Fixes for Column Resizing and Preventing Crashes when adding and removing Columns</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="
SGrid 2.0 is an updated version of the popular SGrid control 
which adds drag-drop hierarchical grouping, owner-draw cells and many other features.  It has 
the same highly-optimised display code but is now further enhanced by much better
sort, row insert and delete performance.  It remains a great alternative to the ListView
in report mode and can now be used to create TaskLists and TreeView-style grouped displays.
" /><link rel="stylesheet" href="../../../../../res/screen.css" media="SCREEN" /><link rel="stylesheet" href="../../../../../res/print.css" media="PRINT" /><link rel="SHORTCUT ICON" href="http://www.vbaccelerator.com/home/res/vbaccel.ico" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000.html";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="../../../../../../../pagead2.googlesyndication.com/pagead/f.txt">
</script>
</p>
</td>
<td></td>
</tr></tr><tr class="navbar"><td><a href="http://www.vbaccelerator.com/home/index.asp"><img width="125" height="25" src="../../../../../res/vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="http://www.vbaccelerator.com/home/index.asp">Home</a>&#160;.&#160;<a href="../../../../index.html">VB</a>&#160;.&#160;<a href="../../../index.html">Code</a>&#160;.&#160;<a href="../../index.html">Controls</a>&#160;.&#160;<a href="../index.html">S Grid 2</a>&#160;.&#160;<a href="article.html">SGrid 2.0</a>&#160;.&#160;<a href="bugTrak.html">BugTrak Summary</a>&#160;.&#160;Various Bug Fixes for Column Resizing and Preventing Crashes when adding and removing Columns</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="../../../../../res/download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="VB5_SGrid_2_Demonstration.html"><img src="../../../../../res/get.png" width="8" height="8" alt="Download Page" />VB5 SGrid 2 Demonstration</a> (144K)</p><p class="nav"><a href="VB5_SGrid_2_Full_Source.html"><img src="../../../../../res/get.png" width="8" height="8" alt="Download Page" />VB5 SGrid 2 Full Source</a> (446K)</p><p class="nav"><a href="VB5_SGrid_2_0_Binary.html"><img src="../../../../../res/get.png" width="8" height="8" alt="Download Page" />VB5 SGrid 2.0 Binary</a> (194K)</p><p /><p class="nav"><a href="VB6_SGrid_2_Binary.html"><img src="../../../../../res/get.png" width="8" height="8" alt="Download Page" />VB6 SGrid 2 Binary</a> (173K)</p><p class="nav"><a href="VB6_SGrid_2_Demonstration.html"><img src="../../../../../res/get.png" width="8" height="8" alt="Download Page" />VB6 SGrid 2 Demonstration</a> (138K)</p><p class="nav"><a href="VB6_SGrid_2_Full_Source.html"><img src="../../../../../res/get.png" width="8" height="8" alt="Download Page" />VB6 SGrid 2 Full Source</a> (419K)</p><br /><br /><img src="../../../../../res/information.png" width="125" height="21" alt="Information" /><p class="nav">Article:13703</p><p class="nav">&#160;&#160;<a href="http://www.vbaccelerator.com/linkto.asp?id=13703&amp;type=Article&amp;title=SGrid%202%2E0">Link to this page</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="../../../../../res/bugTrak.png" width="125" height="21" alt="BugTrak System" />﻿<p class="nav"><a href="bugTrak.html">BugTrak</a></p><p class="nav"><a href="bugTrak.html#bugs"><img src="../../../../../res/btBug.png" width="16" height="16" alt="Bug" />&#160;Bugs:</a> 4 / 5</p><p class="nav"><a href="bugTrak.html#issues"><img src="../../../../../res/btIssue.png" width="16" height="16" alt="Issue" />&#160;Issues:</a> 8 / 8</p><p class="nav"><a href="bugTrak.html#questions"><img src="../../../../../res/btQuestion.png" width="16" height="16" alt="Question" />&#160;Questions:</a> 0 / 0</a></p><p class="nav">Updated:9 February 2004</p>
<br /><br /><img src="../../../../../res/updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="../../../../../res/update.png" width="8" height="8" alt="Update" />10 Feb 2004<br /><p class="update">The VB6 Downloads for the Grid contained incorrect files. The versions
posted now have the correct files.  Please ensure your version of vbalSGrid6.OCX has the file
version 2.0.0.40 and accept my apologies for this stupid error.</p><p class="update">TaskList demo had a missing line in the mnuColumns event handler which
caused a 'Subscript out of Range' error when showing or hiding columns (it was trying
to hide/show column 0).  Fixed.</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="../../../../../res/related.png" width="125" height="21" alt="Related Items" />﻿<p class="nav"><img src="../../../../../res/rel.png" width="8" height="8" alt="Related Item" /><a href="http://www.vbaccelerator.com/article.asp?id=17">Subclassing Without The Crashes</a></p><p class="nav"><img src="../../../../../res/rel.png" width="8" height="8" alt="Related Item" /><a href="http://www.vbaccelerator.com/article.asp?id=2">vbAccelerator ImageList Control and Class v2.0</a></p><p class="nav"><img src="../../../../../res/rel.png" width="8" height="8" alt="Related Item" /><a href="http://www.vbaccelerator.com/article.asp?id=11">vbAccelerator S-Grid Control</a></p><br /><br /><img src="../../../../../res/search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="http://www.google.com/search"><img src="../../../../../../../www.google.com/logos/Logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="http://www.vbaccelerator.com/home/The_Site/NewSite/article.asp"><img src="../../../../../res/newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>Various Bug Fixes for Column Resizing and Preventing Crashes when adding and removing Columns</h1><h2>Summary</h2><table class="article"><tr><td>Id:</td><td>13703.12</td></tr><tr><td>Type:</td><td><img src="../../../../../res/btBugClosed.png" width="16" height="16" alt="Bug" />&#160;Bug</td></tr><tr><td>Current Status:</td><td>Resolution Identified</td></tr></table><h2>Detail</h2><table class="article"><tr class="header"><td>6&#160;Feb&#160;2004</td><td>Resolution Identified</td><td width="100%">Thierry Waty</td></tr><tr><td colspan="3"><p>I have fixed some bugs in ssGrid 2 that have been carried forward from version 1. </p><p>Like Resising columns with bigger headers, and some headers where truncated, and some other minor bugs. Here are the fixes, only the code extracted:</p><p>1) Header Text Width</p><pre>' *** TWA
Private Property Get plHeaderEvaluateTextWidth( _
   ByVal lCol As Long, _
   ByVal lMaxWidth As Long _
   ) As Long
   Dim tR               As RECT
   Dim sCopy            As String
   Dim sOrig            As String
   Dim iCol             As Long
   Dim lCCol            As Long
   Dim eFlags           As ECGTextAlignFlags
   Dim lLastRight       As Long
 
   ' Find the index of lCol in the columns array:
   For iCol = 1 To m_iCols
      If (m_tCols(iCol).lCellColIndex = lCol) Then
         lCCol = iCol
         Exit For
      End If
   Next iCol
 
   ' Evaluate the text in the cell:
   If Not (IsMissing(m_tCols(lCol).sHeader)) Then
      sCopy = m_tCols(lCol).sHeader
   End If
   If (m_tCols(lCCol).sFmtString &lt;&gt; "") Then
      sCopy = Format$(sCopy, m_tCols(lCCol).sFmtString)
   End If
   eFlags = m_tCols(lCol).eTextAlign Or DT_CALCRECT
 
   ' For multi line we specify the right so we get a height:
   If (eFlags And DT_WORDBREAK) = DT_WORDBREAK Then
      tR.right = m_tCols(lCCol).lWidth
      If (lMaxWidth &gt; tR.right) Then
         tR.right = lMaxWidth
      End If
   End If
 
   sOrig = sCopy
   DrawText m_hDC, sCopy &amp; "... " &amp; vbNullChar, -1, tR, eFlags
   If (eFlags And DT_WORDBREAK) = DT_WORDBREAK Then
      sCopy = sOrig
      ' Extend in blocks of 16 until we fit...
      tR.right = tR.right + 16
      lLastRight = tR.right
      DrawText m_hDC, sCopy &amp; "... " &amp; vbNullChar, -1, tR, eFlags
      tR.right = lLastRight
   End If
 
   plHeaderEvaluateTextWidth = tR.right - tR.left
 
End Property
' *** TWA
</pre><p>2) Selected Row</p><pre>Public Property Let SelectedRow(ByVal lRow As Long)
   Dim iCol             As Long
   Dim iRow             As Long
   
   ' *** TWA
   'If (m_iSelCol = 0) Then
      'm_iSelCol = plGetFirstVisibleColumn()
   'End If
   
   If m_iRows = 0 Then
      Exit Property
   End If
   ' *** TWA
   If (lRow &gt; 0) And (lRow &lt;= m_iRows) Then
      m_iSelRow = lRow
      If (m_bMultiSelect) Then
</pre><p>3) RemoveColumn:</p><pre>         ' Having removed the column, rebuild the grid cells:
         ' *** TWA
         'ReDim m_tCells(1 To m_iCols, 1 To m_iRows) As tGridCell
         ReDim m_tCells(1 To m_iCols, 1 To m_iRows + 1) As tGridCell
         ' *** TWA
         For iRow = 1 To m_iRows
            For iCol = 1 To m_iCols
               If (iCol &gt;= lCol) Then
                  lGridCol = iCol + 1
               Else
                  lGridCol = iCol
               End If
               LSet m_tCells(iCol, m_tRows(iRow).lGridCellArrayRow) = _
                  tGridCopy(lGridCol, m_tRows(iRow).lGridCellArrayRow)
            Next iCol
         Next iRow
</pre><p>4) AutoWidthColumn:</p><pre>Public Sub AutoWidthColumn(ByVal vKey As Variant)
   Dim iRow             As Long
   Dim lWidth           As Long
   Dim lMaxWidth        As Long
   Dim lMaxTextWidth    As Long
   Dim iCol             As Long
   Dim iCCol            As Long
 
   iCol = ColumnIndexByVariant(vKey)
   If (iCol &gt; 0) Then
      iCCol = m_tCols(iCol).lCellColIndex
      ' *** TWA
      ' *** Keep the width of the column header
      lMaxWidth = plHeaderEvaluateTextWidth(iCCol, lMaxTextWidth)
      ' *** TWA
      For iRow = 1 To m_iRows
</pre><p>5) ColumnWidthChanged (this increases performance):</p><pre>   If Not bCancel Then
      ' *** TWA
      If ColumnWidth(lColIndex) &lt;&gt; lWidth Then
         ColumnWidth(lColIndex) = lWidth
      End If
      ' *** TWA
      m_bDirty = True
      Draw
      pResizeHeader
   End If
 
</pre></td></tr></table><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center"></p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="http://www.vbaccelerator.com/home/index.asp"><img width="125" height="25" src="../../../../../res/vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="http://www.vbaccelerator.com/home/index.asp">Home</a>&#160;.&#160;<a href="../../../../index.html">VB</a>&#160;.&#160;<a href="../../../index.html">Code</a>&#160;.&#160;<a href="../../index.html">Controls</a>&#160;.&#160;<a href="../index.html">S Grid 2</a>&#160;.&#160;<a href="article.html">SGrid 2.0</a>&#160;.&#160;<a href="bugTrak.html">BugTrak Summary</a>&#160;.&#160;Various Bug Fixes for Column Resizing and Preventing Crashes when adding and removing Columns</p><br /><p class="nav"><a href="http://www.vbaccelerator.com/home/The_Site/Copyright/article.asp">Copyright</a> &#169; 2004 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 6 February 2004</p></td><td></td></tr></table>
</body>
<!-- Mirrored from www.vbaccelerator.com/home/VB/Code/Controls/S_Grid_2/S_Grid_2/bugTrak13703-12.asp by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Jun 2015 21:30:06 GMT -->
</html>