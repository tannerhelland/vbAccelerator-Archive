<html lang="en" >

<!-- Mirrored from www.vbaccelerator.com/home/VB/Code/Controls/Toolbar/vbAccelerator_Office_Docking_Bar/VB5_OfficeBar_Full_Source_zip_mDockContainer_bas.asp by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Jun 2015 21:30:08 GMT -->
<head>
<title>vbAccelerator - Contents of code file: mDockContainer.bas</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: mDockContainer.bas" /><link rel="stylesheet" href="../../../../../res/screen.css" media="SCREEN" /><link rel="stylesheet" href="../../../../../res/print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000.html";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="../../../../../../../pagead2.googlesyndication.com/pagead/f.txt">
</script>
</p>
</td>
<td></td>
</tr></tr><tr class="navbar"><td><a href="http://www.vbaccelerator.com/home/index.asp"><img width="125" height="25" src="../../../../../res/vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="http://www.vbaccelerator.com/home/index.asp">Home</a>&#160;.&#160;<a href="../../../../index.html">VB</a>&#160;.&#160;<a href="../../../index.html">Code</a>&#160;.&#160;<a href="../../index.html">Controls</a>&#160;.&#160;<a href="../index.html">Toolbar</a>&#160;.&#160;<a href="article.html">vbAccelerator Office Docking Bar Control</a>&#160;.&#160;<a href="VB5_OfficeBar_Full_Source.html">VB5 OfficeBar Full Source</a>&#160;.&#160;mDockContainer.bas</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="../../../../../res/download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="VB5_OfficeBar_Binary.html"><img src="../../../../../res/get.png" width="8" height="8" alt="Download Page" />VB5 OfficeBar Binary</a> (35K)</p><p class="nav"><a href="VB5_OfficeBar_Demonstration.html"><img src="../../../../../res/get.png" width="8" height="8" alt="Download Page" />VB5 OfficeBar Demonstration</a> (68K)</p><p class="nav"><a href="VB5_OfficeBar_Full_Source.html"><img src="../../../../../res/get.png" width="8" height="8" alt="Download Page" />VB5 OfficeBar Full Source</a> (138K)</p><p /><p class="nav"><a href="VB6_OfficeBar_Binary.html"><img src="../../../../../res/get.png" width="8" height="8" alt="Download Page" />VB6 OfficeBar Binary</a> (35K)</p><p class="nav"><a href="VB6_OfficeBar_Demonstration.html"><img src="../../../../../res/get.png" width="8" height="8" alt="Download Page" />VB6 OfficeBar Demonstration</a> (65K)</p><p class="nav"><a href="VB6_OfficeBar_Full_Source.html"><img src="../../../../../res/get.png" width="8" height="8" alt="Download Page" />VB6 OfficeBar Full Source</a> (134K)</p><br /><br /><img src="../../../../../res/information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:11870</p><p class="nav">&#160;&#160;<a href="http://www.vbaccelerator.com/linkto.asp?id=11870&amp;type=Zip&amp;title=VB5%20OfficeBar%20Full%20Source%2Ezip%5FmDockContainer">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="../../../../../res/bugTrak.png" width="125" height="21" alt="BugTrak System" />﻿<p class="nav"><a href="bugTrak.html">BugTrak</a></p><p class="nav"><a href="bugTrak.html#bugs"><img src="../../../../../res/btBug.png" width="16" height="16" alt="Bug" />&#160;Bugs:</a> 5 / 6</p><p class="nav"><a href="bugTrak.html#issues"><img src="../../../../../res/btIssue.png" width="16" height="16" alt="Issue" />&#160;Issues:</a> 0 / 0</p><p class="nav"><a href="bugTrak.html#questions"><img src="../../../../../res/btQuestion.png" width="16" height="16" alt="Question" />&#160;Questions:</a> 0 / 0</a></p><p class="nav">Updated:6 February 2004</p>
<br /><br /><img src="../../../../../res/updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="../../../../../res/update.png" width="8" height="8" alt="Update" />5 Jul 2003<br /><p class="update">Corrected Demonstration projects</p><p class="update">Added note about IDE error when undocking</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="../../../../../res/related.png" width="125" height="21" alt="Related Items" />﻿<p class="nav"><img src="../../../../../res/rel.png" width="8" height="8" alt="Related Item" /><a href="http://www.vbaccelerator.com/article.asp?id=1272">vbAccelerator Toolbar and CoolMenu Control v3.5</a></p><p class="nav"><img src="../../../../../res/rel.png" width="8" height="8" alt="Related Item" /><a href="http://www.vbaccelerator.com/article.asp?id=7">PopupMenu DLL - Create Unlimited Popup Menus</a></p><p class="nav"><img src="../../../../../res/rel.png" width="8" height="8" alt="Related Item" /><a href="http://www.vbaccelerator.com/article.asp?id=17">Subclassing Without The Crashes</a></p><p class="nav"><img src="../../../../../res/rel.png" width="8" height="8" alt="Related Item" /><a href="http://www.vbaccelerator.com/article.asp?id=2310">vbAccelerator MDITabs Control</a></p><br /><br /><img src="../../../../../res/search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="http://www.google.com/search"><img src="../../../../../../../www.google.com/logos/Logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="http://www.vbaccelerator.com/home/The_Site/NewSite/article.asp"><img src="../../../../../res/newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: mDockContainer.bas</h1><pre>Attribute VB_Name = "mDockContainer"
Option Explicit

Public Const DOCKCONTAINERID = "vbal:DockContainer:lPtr"
Public Const DOCKCONTAINERVERTICAL = "vbal:DockContainer:Vertical"
Public Const DOCKCONTAINERBARINDEX = "vbal:DockContainer:BarIndex"
Public Const MDITOOLBARMENUID = "vbal:MDIToolbarMenu:lPtr"
Public Const DOCKCONTAINERPARENTHWND = "vbal:DockContainer:ParenthWnd"
Public Const UNDOCKEDCONTAINERID = "vbal:UndockedContainer:lPtr"

Public Const TOOLWINDOWPARENTWINDOWHWND = "vbal:ToolWindow:ParenthWnd"


Public Type POINTAPI
   x As Long
   y As Long
End Type
Public Type RECT
   Left As Long
   Top As Long
   Right As Long
   Bottom As Long
End Type
Public Declare Function GetProp Lib "user32" Alias "GetPropA" (ByVal hwnd As
 Long, ByVal lpString As String) As Long
Public Declare Function SetProp Lib "user32" Alias "SetPropA" (ByVal hwnd As
 Long, ByVal lpString As String, ByVal hData As Long) As Long
Public Declare Function RemoveProp Lib "user32" Alias "RemovePropA" (ByVal hwnd
 As Long, ByVal lpString As String) As Long

Public Declare Function GetCursorPos Lib "user32" (lpPoint As POINTAPI) As Long
Public Declare Function GetWindowRect Lib "user32" (ByVal hwnd As Long, lpRect
 As RECT) As Long
Public Declare Function GetParent Lib "user32" (ByVal hwnd As Long) As Long
Public Declare Function ScreenToClient Lib "user32" (ByVal hwnd As Long,
 lpPoint As POINTAPI) As Long

Public Declare Function RedrawWindowAsNull Lib "user32" Alias "RedrawWindow"
 (ByVal hwnd As Long, lprcUpdate As Any, ByVal hrgnUpdate As Long, ByVal
 fuRedraw As Long) As Long
Public Const RDW_ALLCHILDREN = &amp;H80
Public Const RDW_ERASE = &amp;H4
Public Const RDW_ERASENOW = &amp;H200
Public Const RDW_FRAME = &amp;H400
Public Const RDW_INTERNALPAINT = &amp;H2
Public Const RDW_INVALIDATE = &amp;H1
Public Const RDW_NOCHILDREN = &amp;H40
Public Const RDW_NOERASE = &amp;H20
Public Const RDW_NOFRAME = &amp;H800
Public Const RDW_NOINTERNALPAINT = &amp;H10
Public Const RDW_UPDATENOW = &amp;H100
Public Const RDW_VALIDATE = &amp;H8

Public Declare Sub CopyMemory Lib "kernel32" Alias "RtlMoveMemory" (pDest As
 Any, pSrc As Any, ByVal ByteLen As Long)

Private Declare Function EnumChildWindows Lib "user32" (ByVal hWndParent As
 Long, ByVal lpEnumFunc As Long, ByVal lParam As Long) As Long

Private Declare Function OleTranslateColor Lib "OLEPRO32.DLL" (ByVal OLE_COLOR
 As Long, ByVal HPALETTE As Long, pccolorref As Long) As Long
Private Const CLR_INVALID = -1

Private Declare Function FindWindowEx Lib "user32" Alias "FindWindowExA" (ByVal
 hWnd1 As Long, ByVal hWnd2 As Long, ByVal lpsz1 As String, lpsz2 As Any) As
 Long

Private m_hWnd() As Long
Private m_lCount As Long

Public Property Get DockTargetCount() As Long
   DockTargetCount = m_lCount
End Property
Public Property Get DockTarget(ByVal lIndex As Long) As Long
   DockTarget = m_hWnd(lIndex)
End Property

Public Property Get objectFromPtr(ByVal lPtr As Long) As Object
Dim objT As Object
   If Not (lPtr = 0) Then
      ' Turn the pointer into an illegal, uncounted interface
      CopyMemory objT, lPtr, 4
      ' Do NOT hit the End button here! You will crash!
      ' Assign to legal reference
      Set objectFromPtr = objT
      ' Still do NOT hit the End button here! You will still crash!
      ' Destroy the illegal reference
      CopyMemory objT, 0&amp;, 4
   End If
End Property

Private Function enumWindowsProc( _
        ByVal lhWnd As Long, _
        ByVal lParam As Long _
    ) As Long
Dim bStop As Boolean
   bStop = False
   If GetProp(lhWnd, DOCKCONTAINERID) &lt;&gt; 0 Then
      m_lCount = m_lCount + 1
      ReDim Preserve m_hWnd(1 To m_lCount) As Long
      m_hWnd(m_lCount) = lhWnd
   End If
   enumWindowsProc = 1
End Function

Public Function findDockTargets( _
      ByVal hWndParent As Long _
   ) As Boolean
   m_lCount = 0
   Erase m_hWnd
   EnumChildWindows hWndParent, AddressOf enumWindowsProc, 0
End Function

Public Function dockCheck( _
      ByVal hWndToolbarWindow As Long, _
      ByVal hWndCtl As Long, _
      ByVal bCanDockHorizontal As Boolean, _
      ByVal bCanDockVertical As Boolean, _
      ByRef hWndDockTo As Long, _
      ByRef lRowDockAt As Long, _
      ByRef lXDockAt As Long _
   ) As Boolean
Dim lhWndP As Long
Dim lhWnd As Long
Dim i As Long
Dim tP As POINTAPI
Dim tTL As POINTAPI
Dim tWR As RECT
Dim tTWR As RECT
Dim bVertical As Boolean
Dim lDiff1 As Long
Dim lDiff2 As Long
Dim bDockCheck As Boolean
Dim ctl As vbalDockContainer
Dim lPtr As Long

   ' Evaluate the owning form of these docking
   ' controls:
   lhWnd = GetParent(hWndCtl)
      
   ' Find all child windows of m_hWndCtl's parent
   ' which are dock targets:
   findDockTargets lhWnd

   ' now check if we dock onto any of them:
   'Debug.Print "DockCheck: " &amp; m_lCount
   GetCursorPos tP
   For i = 1 To m_lCount
      GetWindowRect m_hWnd(i), tWR
      'Debug.Print i, tWR.Left, tWR.Top, tWR.Right, tWR.Bottom
      bVertical = (GetProp(m_hWnd(i), DOCKCONTAINERVERTICAL) &lt;&gt; 0)
      If tP.y &gt;= tWR.Top And tP.y &lt;= tWR.Bottom Then
         If tP.x &gt;= tWR.Left And tP.x &lt;= tWR.Right Then
            'Debug.Print "Dock Target:" &amp; m_hWnd(i)
            hWndDockTo = m_hWnd(i)
            GetWindowRect hWndToolbarWindow, tTWR
            tTL.x = tTWR.Left
            tTL.y = tTWR.Top
            ScreenToClient hWndDockTo, tTL
            If bVertical Then
               If (bCanDockVertical) Then
                  bDockCheck = True
                  
                  lPtr = GetProp(m_hWnd(i), DOCKCONTAINERID)
                  If Not (lPtr = 0) Then
                     Set ctl = objectFromPtr(lPtr)
                     If (ctl.LockToolBars) Then
                        bDockCheck = False
                     End If
                  End If
                  
                  If (bDockCheck) Then
                     lDiff1 = Abs(tP.x - tWR.Left)
                     lDiff2 = Abs(tP.x - tWR.Right)
                     If lDiff1 &gt; lDiff2 Then
                        lRowDockAt = -1
                     Else
                        lRowDockAt = 0
                     End If
                     GetCursorPos tTL
                     ScreenToClient hWndDockTo, tTL
                     lXDockAt = tTL.y
                  End If
                  
               End If
            Else
               If (bCanDockHorizontal) Then
                  bDockCheck = True
               
                  lPtr = GetProp(m_hWnd(i), DOCKCONTAINERID)
                  If Not (lPtr = 0) Then
                     Set ctl = objectFromPtr(lPtr)
                     If (ctl.LockToolBars) Then
                        bDockCheck = False
                     End If
                  End If
                  
                  If (bDockCheck) Then
                     lDiff1 = Abs(tP.y - tWR.Top)
                     lDiff2 = Abs(tP.y - tWR.Bottom)
                     If lDiff1 &gt; lDiff2 Then
                        lRowDockAt = -1
                     Else
                        lRowDockAt = 0
                     End If
                     ' Work out where we are l-r on the window:
                     GetCursorPos tTL
                     ScreenToClient hWndDockTo, tTL
                     lXDockAt = tTL.x
                  End If
               End If
            End If
            If Not bDockCheck Then
               Screen.MousePointer = vbNoDrop
            Else
               Screen.MousePointer = vbSizeAll
            End If
            dockCheck = bDockCheck
            Exit For
         End If
      End If
   Next i
   Screen.MousePointer = vbSizeAll
   
End Function

Public Function TranslateColor(ByVal oClr As OLE_COLOR, _
                        Optional hPal As Long = 0) As Long
    ' Convert Automation color to Windows color
    If OleTranslateColor(oClr, hPal, TranslateColor) Then
        TranslateColor = CLR_INVALID
    End If
End Function
Public Property Get BlendColor( _
      ByVal oColorFrom As OLE_COLOR, _
      ByVal oColorTo As OLE_COLOR, _
      Optional ByVal alpha As Long = 128 _
   ) As Long
Dim lCFrom As Long
Dim lCTo As Long
   lCFrom = TranslateColor(oColorFrom)
   lCTo = TranslateColor(oColorTo)
Dim lSrcR As Long
Dim lSrcG As Long
Dim lSrcB As Long
Dim lDstR As Long
Dim lDstG As Long
Dim lDstB As Long
   lSrcR = lCFrom And &amp;HFF
   lSrcG = (lCFrom And &amp;HFF00&amp;) \ &amp;H100&amp;
   lSrcB = (lCFrom And &amp;HFF0000) \ &amp;H10000
   lDstR = lCTo And &amp;HFF
   lDstG = (lCTo And &amp;HFF00&amp;) \ &amp;H100&amp;
   lDstB = (lCTo And &amp;HFF0000) \ &amp;H10000
     
   
   BlendColor = RGB( _
      ((lSrcR * alpha) / 255) + ((lDstR * (255 - alpha)) / 255), _
      ((lSrcG * alpha) / 255) + ((lDstG * (255 - alpha)) / 255), _
      ((lSrcB * alpha) / 255) + ((lDstB * (255 - alpha)) / 255) _
      )
      
End Property

Public Property Get VSNetControlColor() As Long
   VSNetControlColor = BlendColor(vbButtonFace, VSNetBackgroundColor, 195)
End Property

Public Property Get VSNetBackgroundColor() As Long
   VSNetBackgroundColor = BlendColor(vbWindowBackground, vbButtonFace, 220)
End Property
Public Property Get VSNetCheckedColor() As Long
   VSNetCheckedColor = BlendColor(vbHighlight, vbWindowBackground, 30)
End Property
Public Property Get VSNetBorderColor() As Long
   VSNetBorderColor = TranslateColor(vbHighlight)
End Property
Public Property Get VSNetSelectionColor() As Long
   VSNetSelectionColor = BlendColor(vbHighlight, vbWindowBackground, 70)
End Property
Public Property Get VSNetPressedColor() As Long
   VSNetPressedColor = BlendColor(vbHighlight, VSNetSelectionColor, 70)
End Property

Public Function mdiChildhWnd(ByVal hWndA As Long) As Long
   mdiChildhWnd = FindWindowEx(hWndA, 0, "MDIClient", ByVal 0&amp;)
End Function
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center"></p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="http://www.vbaccelerator.com/home/index.asp"><img width="125" height="25" src="../../../../../res/vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="http://www.vbaccelerator.com/home/index.asp">Home</a>&#160;.&#160;<a href="../../../../index.html">VB</a>&#160;.&#160;<a href="../../../index.html">Code</a>&#160;.&#160;<a href="../../index.html">Controls</a>&#160;.&#160;<a href="../index.html">Toolbar</a>&#160;.&#160;<a href="article.html">vbAccelerator Office Docking Bar Control</a>&#160;.&#160;<a href="VB5_OfficeBar_Full_Source.html">VB5 OfficeBar Full Source</a>&#160;.&#160;mDockContainer.bas</p><br /><p class="nav"><a href="http://www.vbaccelerator.com/home/The_Site/Copyright/article.asp">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 6 July 2003</p></td><td></td></tr></table>
</body>
<!-- Mirrored from www.vbaccelerator.com/home/VB/Code/Controls/Toolbar/vbAccelerator_Office_Docking_Bar/VB5_OfficeBar_Full_Source_zip_mDockContainer_bas.asp by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Jun 2015 21:30:08 GMT -->
</html>