<html lang="en" >

<!-- Mirrored from www.vbaccelerator.com/home/VB/Code/Libraries/Subclassing/Registered_Hotkeys/VB_HotKey_Configuration_Sample_zip_mEarthquake_bas.asp by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Jun 2015 21:30:38 GMT -->
<head>
<title>vbAccelerator - Contents of code file: mEarthquake.bas</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: mEarthquake.bas" /><link rel="stylesheet" href="../../../../../res/screen.css" media="SCREEN" /><link rel="stylesheet" href="../../../../../res/print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000.html";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="../../../../../../../pagead2.googlesyndication.com/pagead/f.txt">
</script>
</p>
</td>
<td></td>
</tr></tr><tr class="navbar"><td><a href="http://www.vbaccelerator.com/home/index.asp"><img width="125" height="25" src="../../../../../res/vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="http://www.vbaccelerator.com/home/index.asp">Home</a>&#160;.&#160;<a href="../../../../index.html">VB</a>&#160;.&#160;<a href="../../../index.html">Code</a>&#160;.&#160;<a href="../../index.html">Libraries</a>&#160;.&#160;<a href="../index.html">Subclassing</a>&#160;.&#160;<a href="article.html">Creating and Responding to System-Wide Hotkeys</a>&#160;.&#160;<a href="VB_HotKey_Configuration_Sample.html">VB HotKey Configuration Sample</a>&#160;.&#160;mEarthquake.bas</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="../../../../../res/download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="VB_HotKey_Configuration_Sample.html"><img src="../../../../../res/get.png" width="8" height="8" alt="Download Page" />VB HotKey Configuration Sample</a> (35K)</p><p /><p class="nav"><a href="VB5_Hot_Key_Sample.html"><img src="../../../../../res/get.png" width="8" height="8" alt="Download Page" />VB5 Hot Key Sample</a> (21K)</p><p /><p class="nav"><a href="VB6_Hot_Key_Sample.html"><img src="../../../../../res/get.png" width="8" height="8" alt="Download Page" />VB6 Hot Key Sample</a> (20K)</p><br /><br /><img src="../../../../../res/information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:5023</p><p class="nav">&#160;&#160;<a href="http://www.vbaccelerator.com/linkto.asp?id=5023&amp;type=Zip&amp;title=VB%20HotKey%20Configuration%20Sample%2Ezip%5FmEarthquake">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="../../../../../res/bugTrak.png" width="125" height="21" alt="BugTrak System" />﻿<p class="nav"><a href="bugTrak.html">BugTrak</a></p><p class="nav"><a href="bugTrak.html#bugs"><img src="../../../../../res/btBug.png" width="16" height="16" alt="Bug" />&#160;Bugs:</a> 2 / 2</p><p class="nav"><a href="bugTrak.html#issues"><img src="../../../../../res/btIssue.png" width="16" height="16" alt="Issue" />&#160;Issues:</a> 0 / 0</p><p class="nav"><a href="bugTrak.html#questions"><img src="../../../../../res/btQuestion.png" width="16" height="16" alt="Question" />&#160;Questions:</a> 0 / 0</a></p><p class="nav">Updated:29 August 2003</p>
<br /><br /><img src="../../../../../res/updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="../../../../../res/update.png" width="8" height="8" alt="Update" />27 Jan 1999<br />First Posted</p><br /><br /><img src="../../../../../res/related.png" width="125" height="21" alt="Related Items" />﻿<p class="nav"><img src="../../../../../res/rel.png" width="8" height="8" alt="Related Item" /><a href="http://www.vbaccelerator.com/article.asp?id=17">Subclassing Without The Crashes</a></p><br /><br /><img src="../../../../../res/search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="http://www.google.com/search"><img src="../../../../../../../www.google.com/logos/Logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="http://www.vbaccelerator.com/home/The_Site/NewSite/article.asp"><img src="../../../../../res/newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: mEarthquake.bas</h1><pre>Attribute VB_Name = "mWindowPlay"
Option Explicit

Private Type RECT
   Left As Long
   Top As Long
   Right As Long
   Bottom As Long
End Type
Private Declare Function EnumWindows Lib "user32" (ByVal lpEnumFunc As Long,
 ByVal lParam As Long) As Long
Private Declare Function IsWindowVisible Lib "user32" (ByVal hwnd As Long) As
 Long
Private Declare Function IsIconic Lib "user32" (ByVal hwnd As Long) As Long
Private Declare Function GetWindowText Lib "user32" Alias "GetWindowTextA"
 (ByVal hwnd As Long, ByVal lpString As String, ByVal cch As Long) As Long
Private Declare Function GetWindowTextLength Lib "user32" Alias
 "GetWindowTextLengthA" (ByVal hwnd As Long) As Long
Private Declare Function GetWindowRect Lib "user32" (ByVal hwnd As Long, lpRect
 As RECT) As Long
Private Declare Function MoveWindow Lib "user32" (ByVal hwnd As Long, ByVal x
 As Long, ByVal y As Long, ByVal nWidth As Long, ByVal nHeight As Long, ByVal
 bRepaint As Long) As Long
Private Declare Function EnumChildWindows Lib "user32" (ByVal hWndParent As
 Long, ByVal lpEnumFunc As Long, ByVal lParam As Long) As Long
Private Declare Function SetParent Lib "user32" (ByVal hWndChild As Long, ByVal
 hWndNewParent As Long) As Long
Private Declare Function OffsetRect Lib "user32" (lpRect As RECT, ByVal x As
 Long, ByVal y As Long) As Long
Private Declare Function InflateRect Lib "user32" (lpRect As RECT, ByVal x As
 Long, ByVal y As Long) As Long
Private Declare Function GetClassName Lib "user32" Alias "GetClassNameA" (ByVal
 hwnd As Long, ByVal lpClassName As String, ByVal nMaxCount As Long) As Long
Private Declare Function SendMessageByLong Lib "user32" Alias "SendMessageA"
 (ByVal hwnd As Long, ByVal wMsg As Long, ByVal wParam As Long, ByVal lParam As
 Long) As Long
Private Const WM_SYSCOMMAND = &amp;H112
Private Const SC_CLOSE = &amp;HF060
Private Const WM_SHOWWINDOW = &amp;H18
Private Const WM_CANCELMODE = &amp;H1F
Private Declare Function GetTickCount Lib "kernel32" () As Long

Private Function EnumWindowsProc( _
        ByVal hwnd As Long, _
        ByVal lParam As Long _
    ) As Long
Dim tR As RECT
   If IsWindowVisible(hwnd) &lt;&gt; 0 Then
      If IsIconic(hwnd) = 0 Then
         If WindowCaption(hwnd) &lt;&gt; "" Then
            GetWindowRect hwnd, tR
            MoveWindow hwnd, tR.Left + Rnd * 16 - 8, tR.Top + Rnd * 16 - 8,
             tR.Right - tR.Left, tR.Bottom - tR.Top, 1
            If (lParam = 2) Then
               ' Watch it...
               EnumChildWindows hwnd, plAddressOf(AddressOf ChildWindowProc), 2
            End If
         End If
      End If
   End If
   EnumWindowsProc = 1
End Function
Private Function ChildWindowProc(ByVal hwnd As Long, ByVal lParam As Long) As
 Long
Dim tR As RECT
   GetWindowRect hwnd, tR
   OffsetRect tR, -tR.Left, -tR.Top
   MoveWindow hwnd, tR.Left + Rnd * 16 - 8, tR.Top + Rnd * 16 - 8, tR.Right -
    tR.Left, tR.Bottom - tR.Top, 1
   ChildWindowProc = 1
End Function

Private Function WindowCaption(ByVal hwnd As Long) As String
Dim sBuf As String
Dim lLen As Long
   lLen = GetWindowTextLength(hwnd)
   If (lLen &gt; 0) Then
      sBuf = String$(lLen + 1, 0)
      GetWindowText hwnd, sBuf, lLen + 1
      WindowCaption = Left$(sBuf, lLen)
   End If
End Function
Private Function ClassName(ByVal hwnd As Long) As String
Dim sBuf As String
Dim lLen As Long
Dim iPos As Long
   sBuf = String$(255, 0)
   lLen = GetClassName(hwnd, sBuf, 255)
   If (lLen &gt; 0) Then
      iPos = InStr(sBuf, vbNullChar)
      If (iPos &gt; 0) Then
         ClassName = Left$(sBuf, iPos - 1)
      Else
         ClassName = sBuf
      End If
   End If
End Function
Public Sub DoEarthQuake(ByVal iType As Long)
   EnumWindows plAddressOf(AddressOf EnumWindowsProc), iType
End Sub
Private Function plAddressOf(ByVal lPtr As Long) As Long
   plAddressOf = lPtr
End Function

Public Sub KillAssistant()
   EnumWindows plAddressOf(AddressOf KillAssistantProc), 0
End Sub
Private Function KillAssistantProc(ByVal hwnd As Long, ByVal lParam As Long) As
 Long
Dim tR As RECT
Dim i As Long
Dim lT As Long
   If (ClassName(hwnd) = "MSOASSISTANT") Then
      GetWindowRect hwnd, tR
      For i = tR.Left To Screen.Width \ Screen.TwipsPerPixelX + Abs(tR.Right -
       tR.Left) Step 16
         tR.Left = tR.Left + 16
         InflateRect tR, -1, -1
         lT = GetTickCount
         Do While GetTickCount &lt; lT + 50
            DoEvents
         Loop
         MoveWindow hwnd, tR.Left, tR.Top, tR.Right - tR.Left, tR.Bottom -
          tR.Top, 1
      Next i
      SendMessageByLong hwnd, WM_CANCELMODE, 0, 0
      SendMessageByLong hwnd, WM_SHOWWINDOW, 0, 0
      KillAssistantProc = 0
   Else
      KillAssistantProc = 1
   End If
End Function
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center"></p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="http://www.vbaccelerator.com/home/index.asp"><img width="125" height="25" src="../../../../../res/vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="http://www.vbaccelerator.com/home/index.asp">Home</a>&#160;.&#160;<a href="../../../../index.html">VB</a>&#160;.&#160;<a href="../../../index.html">Code</a>&#160;.&#160;<a href="../../index.html">Libraries</a>&#160;.&#160;<a href="../index.html">Subclassing</a>&#160;.&#160;<a href="article.html">Creating and Responding to System-Wide Hotkeys</a>&#160;.&#160;<a href="VB_HotKey_Configuration_Sample.html">VB HotKey Configuration Sample</a>&#160;.&#160;mEarthquake.bas</p><br /><p class="nav"><a href="http://www.vbaccelerator.com/home/The_Site/Copyright/article.asp">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 12 April 2003</p></td><td></td></tr></table>
</body>
<!-- Mirrored from www.vbaccelerator.com/home/VB/Code/Libraries/Subclassing/Registered_Hotkeys/VB_HotKey_Configuration_Sample_zip_mEarthquake_bas.asp by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Jun 2015 21:30:38 GMT -->
</html>