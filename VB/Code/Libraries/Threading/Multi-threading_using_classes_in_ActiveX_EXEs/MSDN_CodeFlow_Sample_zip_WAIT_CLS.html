<html lang="en" >

<!-- Mirrored from www.vbaccelerator.com/home/VB/Code/Libraries/Threading/Multi-threading_using_classes_in_ActiveX_EXEs/MSDN_CodeFlow_Sample_zip_WAIT_CLS.asp by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Jun 2015 21:30:51 GMT -->
<head>
<title>vbAccelerator - Contents of code file: WAIT.CLS</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: WAIT.CLS" /><link rel="stylesheet" href="../../../../../res/screen.css" media="SCREEN" /><link rel="stylesheet" href="../../../../../res/print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000.html";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="../../../../../../../pagead2.googlesyndication.com/pagead/f.txt">
</script>
</p>
</td>
<td></td>
</tr></tr><tr class="navbar"><td><a href="http://www.vbaccelerator.com/home/index.asp"><img width="125" height="25" src="../../../../../res/vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="http://www.vbaccelerator.com/home/index.asp">Home</a>&#160;.&#160;<a href="../../../../index.html">VB</a>&#160;.&#160;<a href="../../../index.html">Code</a>&#160;.&#160;<a href="../../index.html">Libraries</a>&#160;.&#160;<a href="../index.html">Threading</a>&#160;.&#160;<a href="article.html">Multi-Threaded VB Using ActiveX EXEs</a>&#160;.&#160;<a href="MSDN_CodeFlow_Sample.html">MSDN CodeFlow Sample</a>&#160;.&#160;WAIT.CLS</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="../../../../../res/download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="MSDN_CodeFlow_Sample.html"><img src="../../../../../res/get.png" width="8" height="8" alt="Download Page" />MSDN CodeFlow Sample</a> (38K)</p><p /><p class="nav"><a href="Multi-Threaded_EXE_Project.html"><img src="../../../../../res/get.png" width="8" height="8" alt="Download Page" />Multi-Threaded EXE Project</a> (18K)</p><br /><br /><img src="../../../../../res/information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:3705</p><p class="nav">&#160;&#160;<a href="http://www.vbaccelerator.com/linkto.asp?id=3705&amp;type=Zip&amp;title=MSDN%20CodeFlow%20Sample%2Ezip%5FWAIT">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="../../../../../res/bugTrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="../../../../../res/updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="../../../../../res/update.png" width="8" height="8" alt="Update" />1 Jan 2000<br />First Posted</p><br /><br /><img src="../../../../../res/related.png" width="125" height="21" alt="Related Items" />﻿<p class="nav"><img src="../../../../../res/rel.png" width="8" height="8" alt="Related Item" /><a href="http://www.vbaccelerator.com/article.asp?id=1026">IShellFolder Extended Type Library Version 1.2 (ISHF_Ex.Tlb)</a></p><p class="nav"><img src="../../../../../res/rel.png" width="8" height="8" alt="Related Item" /><a href="http://www.vbaccelerator.com/article.asp?id=3377">Finding Which DLL Contains an API Call</a></p><br /><br /><img src="../../../../../res/search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="http://www.google.com/search"><img src="../../../../../../../www.google.com/logos/Logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="http://www.vbaccelerator.com/home/The_Site/NewSite/article.asp"><img src="../../../../../res/newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: WAIT.CLS</h1><pre>VERSION 1.0 CLASS
BEGIN
  MultiUse = -1  'True
END
Attribute VB_Name = "Wait"
Attribute VB_GlobalNameSpace = True
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = True
'-------------------------------------------------------------------------------
' Copyright  1997 Microsoft Corporation. All rights reserved.
'
' You have a royalty-free right to use, modify, reproduce and distribute the
' Sample Application Files (and/or any modified version) in any way you find
' useful, provided that you agree that Microsoft has no warranty, obligations or
' liability for any Sample Application Files.
'-------------------------------------------------------------------------------

Option Explicit

'-------------------------------------------------------------------------------
'Declarations for waitevents:

Private Declare Function GetMessage Lib "user32" Alias "GetMessageA" ( _
    lpMsg As MSG, ByVal hWnd As Long, ByVal wMsgFilterMin As Long, _
    ByVal wMsgFilterMax As Long) As Long
Private Declare Function TranslateMessage Lib "user32" (lpMsg As MSG) As Long
Private Declare Function DispatchMessageA Lib "user32" (lpMsg As MSG) As Long

Private Type POINTAPI
    x As Long
    y As Long
End Type

Private Type MSG
    hWnd    As Long
    message As Long
    wParam  As Long
    lParam  As Long
    time    As Long
    pt      As POINTAPI
End Type

Private mfStopContinue As Boolean
Private mfStopTimedOut As Boolean
Private mfStopAll As Boolean
Private WithEvents moTimer As objTimer
Attribute moTimer.VB_VarHelpID = -1
Private mnWaitCount As Long
Private mnTimerUses As Long

'-------------------------------------------------------------------------------
'Initialization and cleanup:

Private Sub Class_Initialize()
    Set moTimer = New objTimer
End Sub

'-------------------------------------------------------------------------------
'WaitEvents:

Public Function WaitEvents(Optional Timeout As Long) As Boolean
    Dim msgMessage As MSG
    Dim nLastTimerInterval As Long

    mfStopContinue = False
    mfStopTimedOut = False
    mfStopAll = False
    'Increment the nesting count
    mnWaitCount = mnWaitCount + 1

    'Turn off the timer. We may start it again if:
    '   1.  This WaitEvents needs it.
    '   2.  After we're done, we determine that a WaitEvents higher up the
     stack needs it.
    'Either way, the timeout period should start all over again.
    moTimer.Enabled = False
    'Cache the old interval so that we can restore it later
    nLastTimerInterval = moTimer.Interval
    'Now determine whether this WaitEvents needs the timer
    If Timeout &gt; 0 Then
        moTimer.Interval = Timeout
        moTimer.Enabled = True
        'Increment the count of WaitEvents calls which rely on the timer
        mnTimerUses = mnTimerUses + 1
    End If
    Do While GetMessage(msgMessage, 0, 0, 0) &lt;&gt; 0
        TranslateMessage msgMessage
        DispatchMessageA msgMessage
        If mfStopAll Then
            WaitEvents = True
            'Leave mfStopAll = True in order to stop the next WaitEvents up the
             nesting stack
            Exit Do
        ElseIf mfStopContinue Then
            WaitEvents = True
            'Avoid stopping the next WaitEvents up the nesting stack
            mfStopContinue = False
            Exit Do
        ElseIf mfStopTimedOut Then
            'Stop this WaitEvents only if it specified a timeout
            If Timeout &gt; 0 Then
                'Avoid stopping the next WaitEvents up the nesting stack
                mfStopTimedOut = False
                Exit Do
            End If
        End If
    Loop
    'Decrement the nesting count
    mnWaitCount = mnWaitCount - 1
    'Again, shut off the timer. We will turn it on again below if we determine
    '   that a WaitEvents higher up the stack needs it.
    moTimer.Enabled = False
    If Timeout &gt; 0 Then
        'This WaitEvents used the timer, but it doesn't need it anymore, so
         decrement the count
        mnTimerUses = mnTimerUses - 1
    End If
    'An ancestor (a WaitEvents higher up the stack) may still need the timer
    If mnTimerUses &gt; 0 Then
        'Restart the ancestor's timeout period
        moTimer.Interval = nLastTimerInterval
        moTimer.Enabled = True
    End If
End Function

Public Sub Continue()
    mfStopContinue = True
End Sub

Public Sub ContinueAll()
    mfStopAll = True
End Sub

Private Sub moTimer_Timer()
    mfStopTimedOut = True
End Sub

Public Property Get Waiting() As Boolean
    Waiting = (mnWaitCount &gt; 0)
End Property
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center"></p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="http://www.vbaccelerator.com/home/index.asp"><img width="125" height="25" src="../../../../../res/vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="http://www.vbaccelerator.com/home/index.asp">Home</a>&#160;.&#160;<a href="../../../../index.html">VB</a>&#160;.&#160;<a href="../../../index.html">Code</a>&#160;.&#160;<a href="../../index.html">Libraries</a>&#160;.&#160;<a href="../index.html">Threading</a>&#160;.&#160;<a href="article.html">Multi-Threaded VB Using ActiveX EXEs</a>&#160;.&#160;<a href="MSDN_CodeFlow_Sample.html">MSDN CodeFlow Sample</a>&#160;.&#160;WAIT.CLS</p><br /><p class="nav"><a href="http://www.vbaccelerator.com/home/The_Site/Copyright/article.asp">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 12 April 2003</p></td><td></td></tr></table>
</body>
<!-- Mirrored from www.vbaccelerator.com/home/VB/Code/Libraries/Threading/Multi-threading_using_classes_in_ActiveX_EXEs/MSDN_CodeFlow_Sample_zip_WAIT_CLS.asp by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Jun 2015 21:30:51 GMT -->
</html>